#!/bin/sh
#------------------------------------------------------------------------------
# =========                 |
# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
#  \\    /   O peration     |
#   \\  /    A nd           | www.openfoam.com
#    \\/     M anipulation  |
#------------------------------------------------------------------------------
#     Copyright (C) 2011-2016 OpenFOAM Foundation
#     Copyright (C) 2017-2019 OpenCFD Ltd.
#------------------------------------------------------------------------------
# License
#     This file is part of OpenFOAM, licensed under GNU General Public License
#     <http://www.gnu.org/licenses/>.
#
# Script
#     Allrun - Customizado para executar blockMesh, checkMesh e o solver.
#
# Description
#     Executa a geraÃ§Ã£o da malha, verifica a malha e roda a simulaÃ§Ã£o.
#
#------------------------------------------------------------------------------

# Entrar no diretÃ³rio do script para garantir que os comandos rodem no local correto
cd "${0%/*}" || exit

# Limpar resultados anteriores (opcional, mas recomendado para evitar conflitos)
# foamCleanCase

# 1. Executar blockMesh para gerar a malha
echo "Executando blockMesh..."
blockMesh

# Verificar se blockMesh foi executado com sucesso
if [ $? -ne 0 ]; then
    echo "Erro: blockMesh falhou. Abortando."
    exit 1
fi

# 2. Executar checkMesh com opÃ§Ãµes completas para verificar a malha
echo "Executando checkMesh com allTopology e allGeometry..."
checkMesh -allTopology -allGeometry

# Verificar se checkMesh foi executado com sucesso
if [ $? -ne 0 ]; then
    echo "Erro: checkMesh falhou. Abortando."
    exit 1
fi

# 3. Executar a aplicaÃ§Ã£o (solver) definida no controlDict
# ATENÃ‡ÃƒO: Substitua 'seuSolver' pelo nome do solver que vocÃª estÃ¡ usando (ex: simpleFoam, pimpleFoam, interFoam, etc.)
# O nome do solver Ã© definido no arquivo controlDict, na entrada 'application'.
echo "Executando o fluxTransportFoam"
fluxTransportFoam > log.fluxTransportFoam

# Verificar se o solver foi executado com sucesso
if [ $? -ne 0 ]; then
    echo "Erro: O solver falhou. Abortando."
    exit 1
fi

echo "SimulaÃ§Ã£o concluÃ­da com sucesso!ðŸŽ‰"

#------------------------------------------------------------------------------
